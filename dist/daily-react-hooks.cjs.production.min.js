"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@daily-co/react-native-daily-js")),n=require("react"),r=e(n),i=require("recoil"),a=e(require("lodash.throttle"));function o(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function u(e){o(a,r,i,u,c,"next",e)}function c(e){o(a,r,i,u,c,"throw",e)}u(void 0)}))}}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l,f=n.createContext(null),d=n.createContext({on:function(){},off:function(){}}),p=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=Object.create((t&&t.prototype instanceof f?t:f).prototype),a=new C(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return{value:void 0,done:!0}}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var u=k(o,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=s(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function f(){}function d(){}function p(){}var v={};u(v,i,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(E([])));m&&m!==t&&n.call(m,i)&&(v=m);var g=p.prototype=f.prototype=Object.create(v);function y(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,a){function o(){return new t((function(r,o){!function r(i,a,o,u){var c=s(e[i],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,o,u)}),(function(e){r("throw",e,o,u)})):t.resolve(f).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,u)}))}u(c.arg)}(i,a,r,o)}))}return r=r?r.then(o,o):o()}}function k(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,u(g,"constructor",p),u(p,"constructor",d),d.displayName=u(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new b(c(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(g),u(g,o,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(l={exports:{}}),l.exports),v=function(){return n.useContext(f)},h=0,m=function(){return h++},g=function(e,t){var r=n.useContext(d),i=r.on,a=r.off,o=n.useState(!1),u=o[0],c=o[1],s=n.useRef(0),l=n.useMemo((function(){return m()}),[]);n.useEffect((function(){if(e&&!u){if(s.current>1e5)return console.error("useDailyEvent called with potentially non-memoized event callback or due to too many re-renders.\n        Memoize using useCallback to avoid re-render loop or reduce the amount of state transitions the callback depends on.\n        Passed callback for '"+e+"' event is NOT registered.",t),void c(!0);s.current++;var n=setTimeout((function(){s.current=0}),50);return i(e,t,l),function(){clearTimeout(n),a(e,l)}}}),[t,e,l,u,a,i])},y=function(e,t,r){void 0===r&&(r=100);var i=n.useContext(d),o=i.on,u=i.off,c=n.useMemo((function(){return m()}),[]),s=n.useRef([]),l=n.useMemo((function(){return a((function(){0!==s.current.length&&(t(s.current),s.current=[])}),r,{trailing:!0})}),[t,r]);n.useEffect((function(){if(e)return o(e,(function(e){s.current.push(e),setTimeout(l,0)}),c),function(){u(e,c)}}),[l,e,c,u,o])},b=i.atom({key:"participants-objects",default:[]}),k=i.selectorFamily({key:"participant",get:function(e){return function(t){var n;return null!=(n=(0,t.get)(b).find((function(t){return t.session_id===e})))?n:null}}}),w=function(e){var t=e.children,a=v();g("active-speaker-change",i.useRecoilCallback((function(e){var t=e.set,n=e.snapshot;return function(){var e=u(p.mark((function e(r){var i,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.activeSpeaker.peerId,e.next=3,n.getPromise(k(i));case 3:if(!(o=e.sent)&&a&&(o=a.participants()[i]),o){e.next=7;break}return e.abrupt("return");case 7:t(b,(function(e){return[].concat(e).map((function(e){return e.session_id===i?c({},e,{last_active:new Date}):e}))}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),[a]));var o=i.useRecoilCallback((function(e){var t=e.set;return function(){var e=u(p.mark((function e(n){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t(b,(function(e){return[].concat(e,Object.values(n)).filter((function(e,t,n){return n.findIndex((function(t){return t.session_id===e.session_id}))==t}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),[]);return n.useEffect((function(){if(a){var e=setInterval((function(){var t=a.participants();"local"in t&&(o(t),clearInterval(e))}),100);return function(){clearInterval(e)}}}),[a,o]),g("joined-meeting",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(b,(function(t){return t.some((function(e){return e.local}))?[].concat(t).map((function(t){return t.local?e.participants.local:t})):[].concat(t,[e.participants.local])}))}}))),y("participant-joined",i.useRecoilCallback((function(e){var t=e.set;return function(){var e=u(p.mark((function e(n){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length){e.next=2;break}return e.abrupt("return");case 2:t(b,(function(e){return[].concat(e,n.map((function(e){return e.participant}))).filter((function(e,t,n){return n.findIndex((function(t){return t.session_id===e.session_id}))==t}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),[])),y("participant-updated",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;e.forEach((function(e){var t=e.participant;n(b,(function(e){return[].concat(e).map((function(e){return e.session_id===t.session_id?t:e}))}))}))}))}}),[])),y("participant-left",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(b,(function(t){return[].concat(t).filter((function(t){return!e.some((function(e){return e.participant.session_id===t.session_id}))}))}))}}),[])),r.createElement(r.Fragment,null,t)},x=i.atom({key:"room",default:null}),C=function(e){var t=e.children,n=v(),a=i.useRecoilCallback((function(e){var t=e.set;return u(p.mark((function e(){var r;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&"left-meeting"!==n.meetingState()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.room();case 4:return(r=e.sent)&&"id"in r&&t(x,r),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))}),[n]);return g("access-state-updated",a),r.createElement(r.Fragment,null,t)},E=["children"],S=function(e,t){var r=void 0===t?{}:t,a=r.onParticipantLeft,o=r.onParticipantUpdated,u=i.useRecoilValue(k(e));return y("participant-updated",n.useCallback((function(t){var n=t.filter((function(t){return t.participant.session_id===e}));n.length&&n.forEach((function(e){setTimeout((function(){return null==o?void 0:o(e)}),0)}))}),[o,e])),y("participant-left",n.useCallback((function(t){if(t.filter((function(t){return t.participant.session_id===e})).length){var n=t[t.length-1];setTimeout((function(){return null==a?void 0:a(n)}),0)}}),[a,e])),u},R=i.atom({key:"active-id",default:""}),L=i.atomFamily({key:"media-track",default:{state:"loading",subscribed:!1}}),_=function(e,t){void 0===t&&(t="video");var r=v(),a=n.useMemo((function(){return e+"-"+t}),[e,t]),o=i.useRecoilValue(L(a)),u=i.useRecoilCallback((function(n){var r=n.transact_UNSTABLE;return function(n){var i=n.filter((function(t){return t.participant.session_id===e}));i.length&&r((function(e){var n=e.set,r=e.reset;i.forEach((function(e){switch(e.action){case"participant-joined":case"participant-updated":n(L(a),e.participant.tracks[t]);break;case"participant-left":r(L(a))}}))}))}}),[a,e,t]);y("participant-joined",u),y("participant-updated",u),y("participant-left",u),g("joined-meeting",i.useRecoilCallback((function(e){var n=e.set;return function(e){n(L(a),e.participants.local.tracks[t])}}),[a,t]));var s=i.useRecoilCallback((function(e){var t=e.set;return function(e){e&&t(L(a),e)}}),[a]);return n.useEffect((function(){if(r){var n=null==r?void 0:r.participants();if(n){var i=Object.values(n).find((function(t){return t.session_id===e}));i&&s(i.tracks[t])}}}),[r,e,s,t]),c({},o,{isOff:"blocked"===o.state||"off"===o.state})},T=i.atom({key:"general-camera-state",default:"pending"}),j=i.atom({key:"general-microphone-state",default:"pending"}),P=i.atom({key:"camera-devices",default:[]}),O=i.atom({key:"microphone-devices",default:[]}),A=i.atom({key:"speaker-devices",default:[]}),I=i.atom({key:"input-settings-error",default:null}),N=i.atom({key:"live-streaming",default:{errorMsg:void 0,isLiveStreaming:!1,layout:void 0}}),V=i.atom({key:"local-id",default:""}),M=i.atom({key:"topology",default:"peer-to-peer"}),U=i.atom({key:"networkQuality",default:100}),D=i.atom({key:"networkThreshold",default:"good"}),B=Boolean,F=function(){return 0},q=i.atomFamily({key:"participant-receive-settings",default:{}}),G=i.atom({key:"waiting-participants",default:[]}),W=i.atomFamily({key:"waiting-participant",default:{awaitingAccess:{level:"full"},id:"",name:""}}),z=i.selector({key:"waitingParticipantsSelector",get:function(e){var t=e.get;return t(G).map((function(e){return t(W(e))}))}});exports.DailyProvider=function(e){var a=e.children,o=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(i[n]=e[n]);return i}(e,E),u=n.useState("callObject"in o?o.callObject:null),c=u[0],l=u[1],p=n.useRef({}),v=n.useCallback((function(e){if("action"in e)for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(null!=(r=null==(i=p.current)||null==(a=i[e.action])?void 0:a.values())?r:[]);!(t=n()).done;){var r,i,a;(0,t.value)(e)}}),[]),h=n.useCallback((function(e){e&&Object.keys(p.current).forEach((function(t){e.off(t,v).on(t,v)}))}),[v]);n.useEffect((function(){if(!c){if("callObject"in o)return l(o.callObject),void h(o.callObject);var e=t.createCallObject(o);l(e),h(e)}}),[c,h,o]);var m=n.useCallback((function(e,t,n){var r,i;p.current[e]||(p.current[e]=new Map,c&&c.off(e,v).on(e,v)),null!=(r=p.current[e])&&r.has(n)||null==(i=p.current[e])||i.set(n,t)}),[c,v]),g=n.useCallback((function(e,t){var n,r;null==(n=p.current[e])||n.delete(t),0===(null==(r=p.current[e])?void 0:r.size)&&(null==c||c.off(e,v),delete p.current[e])}),[c,v]);return r.createElement(i.RecoilRoot,null,r.createElement(f.Provider,{value:c},r.createElement(d.Provider,{value:{on:m,off:g}},r.createElement(C,null,r.createElement(w,null,a)))))},exports.useActiveParticipant=function(e){var t=void 0===e?{}:e,r=t.ignoreLocal,a=void 0!==r&&r,o=t.onActiveSpeakerChange,u=v(),c=i.useRecoilValue(R),s=n.useState(""),l=s[1],f=S(s[0]);return n.useEffect((function(){var e;if(u){var t=null==u||null==(e=u.participants())?void 0:e.local;a&&c===(null==t?void 0:t.session_id)||l(c)}}),[u,a,c]),g("active-speaker-change",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(R,e.activeSpeaker.peerId),setTimeout((function(){return null==o?void 0:o(e)}),0)}}),[o])),f},exports.useAudioTrack=function(e){return _(e,"audio")},exports.useDaily=v,exports.useDailyEvent=g,exports.useDevices=function(){var e=v(),t=i.useRecoilValue(T),r=i.useRecoilValue(j),a=i.useRecoilValue(P),o=i.useRecoilValue(O),s=i.useRecoilValue(A),l=i.useRecoilCallback((function(t){var n=t.transact_UNSTABLE;return u(p.mark((function t(){var r,i,a,o,u,c,s,l,f,d,v,h;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(null==(r=navigator)||null==(i=r.mediaDevices)?void 0:i.getUserMedia)&&void 0!==(null==(a=navigator)||null==(o=a.mediaDevices)?void 0:o.enumerateDevices)){t.next=3;break}return n((function(e){var t=e.set;t(T,"not-supported"),t(j,"not-supported")})),t.abrupt("return");case 3:if(e){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,e.enumerateDevices();case 8:return c=(u=t.sent.devices).filter((function(e){return"videoinput"===e.kind&&""!==e.deviceId})),s=u.filter((function(e){return"audio"===e.kind&&""!==e.deviceId})),t.next=14,e.getInputDevices();case 14:f=(l=t.sent).camera,d=l.mic,v=function(e,t,n){var r,i;return{device:t,selected:"deviceId"in e&&t.deviceId===e.deviceId,state:null!=(r=null==(i=n.find((function(e){return e.device.deviceId===t.deviceId})))?void 0:i.state)?r:"granted"}},h=function(e,t){return"default"===e.device.deviceId?-1:"default"===t.device.deviceId?1:e.device.label<t.device.label?-1:e.device.label>t.device.label?1:0},n((function(e){var t=e.set;t(P,(function(e){return c.filter(Boolean).map((function(t){return v(f,t,e)})).sort(h)})),t(O,(function(e){return s.filter(Boolean).map((function(t){return v(d,t,e)})).sort(h)}))})),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(5),n((function(e){var t=e.set;t(T,"not-supported"),t(j,"not-supported")}));case 25:case"end":return t.stop()}}),t,null,[[5,22]])})))}),[e]),f=i.useRecoilCallback((function(t){var n=t.set,r=t.snapshot,i=t.transact_UNSTABLE;return u(p.mark((function t(){var a,o,u,s,f,d,v,h,m,g,y,b,k,w,x,C,E;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,r.getPromise(T);case 4:return k=t.sent,t.next=7,r.getPromise(j);case 7:w=t.sent,x=e.participants().local.tracks,C="pending"===k&&"interrupted"===x.video.state,E="pending"===w&&"interrupted"===x.audio.state,null!=(a=x.audio)&&null!=(o=a.blocked)&&o.byDeviceInUse?i((function(e){var t=e.set;t(j,"in-use"),t(O,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"in-use"}):e}))}))})):null!=(u=x.audio)&&null!=(s=u.blocked)&&s.byDeviceMissing?n(j,"not-found"):null!=(f=x.audio)&&null!=(d=f.blocked)&&d.byPermissions?n(j,"blocked"):E||i((function(e){var t=e.set;t(j,"granted"),t(O,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"granted"}):e}))}))})),null!=(v=x.video)&&null!=(h=v.blocked)&&h.byDeviceInUse?i((function(e){var t=e.set;t(T,"in-use"),t(P,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"in-use"}):e}))}))})):null!=(m=x.video)&&null!=(g=m.blocked)&&g.byDeviceMissing?n(T,"not-found"):null!=(y=x.video)&&null!=(b=y.blocked)&&b.byPermissions?n(T,"blocked"):C||i((function(e){var t=e.set;t(T,"granted"),t(P,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"granted"}):e}))}))})),l();case 14:case"end":return t.stop()}}),t)})))}),[e,l]);g("participant-updated",n.useCallback((function(e){e.participant.local&&f()}),[f])),g("available-devices-updated",l),g("error",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){switch(e.errorMsg){case"not allowed":t((function(e){var t=e.set;t(T,"blocked"),t(j,"blocked")})),f()}}}),[f])),g("started-camera",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(){t((function(e){var t=e.set;t(T,"granted"),t(j,"granted")})),f()}}),[f]));var d=n.useCallback(function(){var t=u(p.mark((function t(n){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==e?void 0:e.setCamera(n);case 2:l();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e,l]),h=n.useCallback(function(){var t=u(p.mark((function t(n){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==e?void 0:e.setAudioDevice(n);case 2:l();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e,l]),m=n.useCallback(function(){var e=u(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Will Implement",t),l();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[l]);return{cameras:a,camState:t,hasCamError:["blocked","in-use","not-found"].includes(t),hasMicError:["blocked","in-use","not-found"].includes(r),microphones:o,micState:r,refreshDevices:l,setCamera:d,setMicrophone:h,setSpeaker:m,speakers:s}},exports.useInputSettings=function(e){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(void 0===e?{}:e),{errorMsg:i.useRecoilValue(I)}},exports.useLiveStreaming=function(e){var t=void 0===e?{}:e,r=t.onLiveStreamingStarted,a=t.onLiveStreamingStopped,o=t.onLiveStreamingError,u=v(),s=i.useRecoilValue(N);return g("live-streaming-started",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(N,{isLiveStreaming:!0,layout:null==e?void 0:e.layout}),setTimeout((function(){return null==r?void 0:r(e)}),0)}}),[r])),g("live-streaming-stopped",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(N,(function(e){return c({},e,{isLiveStreaming:!1,layout:void 0})})),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a])),g("live-streaming-error",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(N,(function(t){return c({},t,{errorMsg:e.errorMsg})})),setTimeout((function(){return null==o?void 0:o(e)}),0)}}),[o])),c({},s,{startLiveStreaming:n.useCallback((function(e){u&&u.startLiveStreaming(e)}),[u]),stopLiveStreaming:n.useCallback((function(){u&&u.stopLiveStreaming()}),[u]),updateLiveStreaming:n.useCallback((function(e){u&&u.updateLiveStreaming({layout:e.layout})}),[u])})},exports.useLocalParticipant=function(){var e=v(),t=i.useRecoilValue(V),r=i.useRecoilCallback((function(e){var t=e.set;return function(e){e&&t(V,e)}}),[]);return n.useEffect((function(){var n;if(e&&!t){if(null==(n=e.participants())||!n.local){var i=function(e){var t,n;null!=e&&null!=(t=e.participant)&&t.local&&r(null==e||null==(n=e.participant)?void 0:n.session_id)};return e.on("participant-updated",i),function(){e.off("participant-updated",i)}}r(e.participants().local.session_id)}}),[e,r,t]),S(t)},exports.useMediaTrack=_,exports.useNetwork=function(e){var t=void 0===e?{}:e,r=t.onNetworkConnection,a=t.onNetworkQualityChange,o=v(),c=i.useRecoilValue(M),s=i.useRecoilValue(U),l=i.useRecoilValue(D),f=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;switch(e.event){case"connected":"peer-to-peer"===e.type&&n(M,"peer-to-peer"),"sfu"===e.type&&n(M,"sfu")}})),setTimeout((function(){return null==r?void 0:r(e)}),0)}}),[r]),d=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;n(U,(function(t){return t!==e.quality?e.quality:t})),n(D,(function(t){return t!==e.threshold?e.threshold:t}))})),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a]);return g("network-connection",f),g("network-quality-change",d),{getStats:n.useCallback(u(p.mark((function e(){var t;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==o?void 0:o.getNetworkStats();case 2:return e.abrupt("return",null==(t=e.sent)?void 0:t.stats);case 4:case"end":return e.stop()}}),e)}))),[o]),quality:s,threshold:l,topology:c}},exports.useParticipant=S,exports.useParticipantIds=function(e){var t=void 0===e?{filter:B,sort:F}:e,r=t.filter,a=void 0===r?B:r,o=t.onActiveSpeakerChange,c=t.onParticipantJoined,s=t.onParticipantLeft,l=t.onParticipantUpdated,f=t.sort,d=void 0===f?F:f,v=i.useRecoilValue(b),h=n.useMemo((function(){var e,t=B;switch(a){case"local":t=function(e){return e.local};break;case"owner":t=function(e){return e.owner};break;case"record":t=function(e){return e.record};break;case"remote":t=function(e){return!e.local};break;case"screen":t=function(e){return e.screen};break;default:t=a}switch(d){case"joined_at":case"session_id":case"user_id":case"user_name":e=function(e,t){return e[d]<t[d]?-1:e[d]>t[d]?1:0};break;default:e=d}return v.filter(t).sort(e).map((function(e){return e.session_id})).filter(Boolean)}),[v,a,d]);return y("participant-joined",n.useCallback((function(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==c?void 0:c(e)}),0)}))}),[c])),y("participant-updated",n.useCallback((function(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==l?void 0:l(e)}),0)}))}),[l])),y("active-speaker-change",n.useCallback(function(){var e=u(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:t.forEach((function(e){return setTimeout((function(){return null==o?void 0:o(e)}),0)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o])),y("participant-left",n.useCallback((function(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==s?void 0:s(e)}),0)}))}),[s])),h},exports.useReceiveSettings=function(e){var t=void 0===e?{}:e,r=t.id,a=void 0===r?"base":r,o=t.onReceiveSettingsUpdated,u=i.useRecoilValue(q("base")),s=i.useRecoilValue(q(a)),l=v();g("receive-settings-updated",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){for(var n=t.set,r=t.reset,i=c({},e.receiveSettings),o=0,u=Object.entries(i);o<u.length;o++){var s=u[o],l=s[1];n(q(s[0]),l)}a in i||r(q(a))})),setTimeout((function(){return null==o?void 0:o(e)}),0)}}),[a,o]));var f=n.useCallback((function(e){l&&"joined-meeting"===l.meetingState()&&(null==l||null==l.updateReceiveSettings||l.updateReceiveSettings(e))}),[l]);return{receiveSettings:"base"===a||0===Object.keys(s).length?u:s,updateReceiveSettings:f}},exports.useRoom=function(){return i.useRecoilValue(x)},exports.useScreenAudioTrack=function(e){return _(e,"screenAudio")},exports.useScreenVideoTrack=function(e){return _(e,"screenVideo")},exports.useThrottledDailyEvent=y,exports.useVideoTrack=function(e){return _(e,"video")},exports.useWaitingParticipants=function(e){var t=void 0===e?{}:e,r=t.onWaitingParticipantAdded,a=t.onWaitingParticipantRemoved,o=t.onWaitingParticipantUpdated,u=v(),c=i.useRecoilValue(z),s=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;n(G,(function(t){return t.includes(e.participant.id)?t:[].concat(t,[e.participant.id])})),n(W(e.participant.id),e.participant)})),setTimeout((function(){return null==r?void 0:r(e)}),0)}}),[r]),l=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.reset;(0,t.set)(G,(function(t){return t.filter((function(t){return t!==e.participant.id}))})),n(W(e.participant.id))})),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a]),f=i.useRecoilCallback((function(e){var t=e.set;return function(e){t(W(e.participant.id),e.participant),setTimeout((function(){return null==o?void 0:o(e)}),0)}}),[o]);g("waiting-participant-added",s),g("waiting-participant-removed",l),g("waiting-participant-updated",f);var d=n.useCallback((function(e,t){"*"!==e?null==u||u.updateWaitingParticipant(e,{grantRequestedAccess:t}):null==u||u.updateWaitingParticipants({"*":{grantRequestedAccess:t}})}),[u]);return{waitingParticipants:c,grantAccess:n.useCallback((function(e){d(e,!0)}),[d]),denyAccess:n.useCallback((function(e){d(e,!1)}),[d])}};
//# sourceMappingURL=daily-react-hooks.cjs.production.min.js.map
